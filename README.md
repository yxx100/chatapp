# chatapp
一、 选题背景
    随着移动互联网的发展，即时通讯类应用已成为人们日常生活中不可或缺的一部分。本项目旨在开发一款基于 Android 平台的聊天应用，实现注册登录、好友管理、消息收发、音视频通话等功能。该项目可作为学习 Android 开发与云后端交互的综合实践案例，具有一定的教学与应用价值。该项目专注于即时文字音频通讯功能，以轻量化为原则。
1.技术栈覆盖
• 综合实践Android开发核心技能：UI设计、网络通信、多媒体处理
• 掌握现代即时通讯技术栈
• 培养开源协作能力（Git项目管理、SDK集成）
2.用户需求
• 部分用户仅需日常交流，无需其他繁琐的功能，需要一款专注于文字音频交流的APP
二、动机
1. 通过在小组合作、作业讨论中的实际情况，提高团队交流能力
2. 将课程知识综合应用，完成一个完整的软件开发项目
3. 通过项目开发，掌握需求分析、系统设计、前后端开发、测试部署等全流程开发技能
三、项目功能
用户身份管理
1. 通过用户账号和密码唯一标识用户，添加了账号验重机制，禁止相同用户名的用户重复注册，并且账号和密码格式均作了部分限制，用户名长度需要在4-20个字符之内，密码不低于6位，注册时用户只需要填写用户名和密码即可完成注册
2. 已注册用户可直接利用用户名和密码进行登录，支持用户退出登录然后进行切换账号
联系人通讯录管理
1. 添加好友：用户可以通过搜索用户名来添加好友，对于搜索到的结果已经是好友、未搜索到和搜索自己并添加好友的情况做了相应的处理，点击添加好友后会向对应的用户发送一条好友请求。
2. 在通讯录列表上方用于显示新的好友请求，用户可以进行同意和拒绝操作，点击同意后双方即可成为好友
3. 通讯录列表好友可以按昵称的首字母进行排序展示，方便用户查找好友
即时通讯功能
1. 实现了实时的文字消息传递功能，保证消息传输的即时性和稳定性
2. 提供了聊天记录的保存功能，与好友聊天时便于检索历史记录
音视频通话
1. 除了实时的文字聊天还可以与好友进行语音通话和视频通话，让通讯效率更加高效
四、项目技术栈
• 开发语言：Java、Kotlin
• 开发环境：Android  Studio
• 架构模式：MVC
• 数据库（数据库层）：Bmob后端云
• 即时通讯后端支持（通讯层）：环信
• 音视频通话：声网（Agora）
• UI框架（前端）：Android View
• 构建工具：Gradle

五、项目架构
1. 模型层（Model）
    职责：负责管理应用程序的数据和业务逻辑。模型直接管理数据、逻辑和规则，不仅包含数据，还包含对这些数据的操作方法。
    实现：主要通过Bmob后端云数据库进行数据的持久化存储，通过使用不同的JavaBean类负责数据库的创建和更新，通过遍历数据库查询联系人数据，聊天记录数据和好友关系数据等，作为应用的业务数据模型。
2. 视图层（View）
    职责：负责生成用户界面并向用户展示数据。视图层是用户直接交互的部分。
    实现：负责UI展示。界面展示和用户交互实现:由xml布局文件和Fragment类组成。布局文件定义界面结构，MainActivity相关布局确定用户信息管理和主要操作界面框架。Fragment类负责动态界面展示与交互，通过加载布局和管理视图元素，接收用户操作并传递给控制器，同时根据反馈更新界面，提供良好交互体验。
    ◦ 启动界面（activity_splash.xml）：主要是展示应用图标
    ◦ 登录界面（activity_login.xml）：提供了文本输入控件，便于用户输入用户名密码，同时还包括注册按钮
    ◦ 注册页面（activity_register.xml）：提供了文本输入控件，便于用户输入用户名密码，同时还包括返回登录界面按钮
    ◦ 主页面（activity_main.xml）：通过底部导航栏将应用划分为三个页面，分别展示不同的内容。
        ▪ 消息界面（message_fragment.xml）：包含聊天信息的展示，显示最后一条聊天记录，对应好友头像，好友昵称等信息
        ▪ 联系人列表界面（contact_fragment.xml）：用于显示新好友的请求，罗列当前的所有好友，显示好友总数目
        ▪ 我的界面（me_fragment.xml）：展示当前的用户头像、用户名等信息，并且包含退出登录的按钮
    ◦ 适配器(Adapter)：用于将数据适配并绑定到对应的UI组件上，使其能够在视图中显示并让用户进行交互
        ▪ ChatAdapter：用于展示当前发送消息的用户的头像和发送的内容
        ▪ ContactAdapter：用于展示好友的用户名和头像信息，同时包含了用户名的首字母显示
        ▪ MessageAdapter：用于展示当前聊天的部分信息，包含好友的头像和用户名以及最后一条消息
3. 控制器层：（Controller）
    职责：作为模型和视图之间的中介，处理用户输入，更新模型和视图。控制器本身不输出任何东西和不做任何处理，他只是接收请求并决定调用那个模型构件去处理请求，然后再确定用哪个视图来显示返回的数据。
    实现：控制器一般由avtivity或fragment承包，用于处理用户的点击事件。
    ◦ SplashActivity：用于展示应用图标，同时判断用户是否登录过，如果登录过就直接跳转到主页面，如果没有登录就跳转到登录页面
    ◦ LoginActivity：接受用户输入的账号和密码，并于数据库进行通讯查找该用户是否存在，处理用户登录按钮的点击事件，处理注册页面的跳转事件
    ◦ RegisterActivity：接受用户输入的账号和密码，并进行合法性检验，处理用户注册按钮的点击事件，用户名合法后将该用户信息保存到数据库
    ◦ NewFriendActivity：显示新好友请求的消息，用于处理对新好友请求的同意和拒绝的点击事件，点击同意按钮后会在后端数据库创建双向的好友关系
    ◦ AddFriendActivity：接受用户输入的账号信息，进行数据库的查询搜索，并将搜索的结果显示在下方，可以点击添加好友发送好友请求
    ◦ ChatActivity：接收用户输入的内容，并对输入信息进行检测，限制其发送的最大长度，超过该长度无法发送，处理用户发送按钮的点击事件，每次打开时从数据库查询与当前好友的历史聊天记录按照时间按顺序排列并展示出来，处理更多选项的点击事件，展示语音通话和视频通话的按钮，处理通话按钮的点击事件

六、数据库设计
    本应用数据库总共包含五个数据表，分别是User、Message、Chat、FriendRelation、FriendRequest。
表名
字段

User
username
password
avatar

Message
title
content
prompt
time
avatar

Chat
sender
receiver
content
time
isRead

FriendRelation
user
friend
usrename
friendname

FriendRequest
requester
receiver
requestername
receivername

    表结构说明
        1. User数据表用于记录用户的基本信息，包含用户名username,密码password,头像avatar等信息，但存储在后端数据库时，会默认分配一个ObjectId，为数据表的主键，用于唯一标识用户
        2. Message数据表用于存储消息列表的信息，包含该条消息的title即对应好友的名字，avatar对应好友的头像，content即最后一条聊天记录，prompt用于显示是否有未读消息，以及对应的未读消息数，time是最后一条消息发送的时间
        3. Chat数据表用于存储聊天记录的数据，包含两个自定义User数据类型的变量sender和receiver，可以链接到对应的User数据表去获取对应用户的所有信息，content用于存储当前聊天记录的内容，time记录当前消息发送时的具体时间便于后期排序处理，isRead通过布尔数据类型判断本条聊天记录是否被对方已读
        4. FriendRelation数据表用于记录好友关系，包含两个自定义User数据类型的变量user和friend，可以链接到对应的User数据表去获取对应用户的所有信息，同时为了方便后端数据库的查看引入了username和friendname属性
        5. FriendRequest数据表用于记录好友关系，包含两个自定义User数据类型的变量requester和receiver，可以链接到对应的User数据表去获取对应用户的所有信息，同时为了方便后端数据库的查看引入了requsetname和receivername属性

七、核心依赖库
• implementation  androidx.appcompat:appcompat:1.2.0
提供了与旧版 Android 兼容的Material Design 组件和主题。
• implementation  com.google.android.material:material:1.2.1:
包含了实现 Material Design 规范的各种I组件。
•  implementation  androidx.constraintlayout:constraintlayout:2.0.1:
提供了一种灵活的布局管理器ConstraintLayout,允许创建复杂的界面而不需要嵌套多层视图。
第三方库
•  implementation("io.github.bmob:android-sdk:4.1.0")
• implementation("io.reactivex.rxjava3:rxjava:3.1.9")
• implementation("io.reactivex.rxjava3:rxandroid:3.0.2")
Bmob后端云数据库的依赖，提供了方便的数据库管理，提供多种方法对数据库进行增删改查等操作，实现了用户信息，聊天记录等信息的存储
• implementation("com.squareup.okhttp3:okhttp:4.8.1")
• implementation("com.squareup.okio:okio:2.2.2")
• implementation("com.google.code.gson:gson:2.8.5")
网络通讯所需要的基本依赖，保证软件运行时与数据库之间的正常通讯
•   implementation("io.hyphenate:hyphenate-chat:4.17.0")
环信SDK通过WebSocket保持应用和环信服务器的长连接，依为本应用提供即时通讯的技术支持，有完备的数据更新推送和消息监听机制，提高用户的体验，基于环信的通讯层使得软件可以真正实现即时通讯
•  implementation("com.github.bumptech.glide:glide:4.15.1")
Glide依赖，是一个安卓的图像加载库，用于显示用户的头像信息
• implementation("org.jetbrains.kotlin:kotlin-stdlib:2.0.21")
kotlin依赖库，由于部分依赖库是由Kotlin编写，所以需要引入kotlin的依赖及相关插件，并配置Kotlin的运行环境，方便使用Java代码去调用KotlinAPI
•  implementation("io.hyphenate:chat-call-kit:4.16.0")
callkit依赖，是声网基于WebRTC编写的音视频通话的集成SDK，封装了部分底层逻辑，使用时需要配置部分自定义项，进行正确的初始化，在对应页面调用相应的API即可实现两个用户的音视频通话
八、分工
王栋：负责对后端逻辑进行分析开发，并对后端代码进行优化
闫晓昕：负责前端UI布局内容的编写，优化与用户的交互页面
九、项目测试
1.性能测试

应用启动响应速度测试
打开设备，启动应用，记录从点击应用到主界面显示的时间。
应用应在3秒内启动并显示主界面。

界面切换响应速度测试
在主界面点击不同功能模块，记录从点击到界面切换完成的时间。
界面切换应在1秒内完成。

数据加载响应速度测试
在需要加载数据的界面进行操作，记录数据加载完成的时间。
数据应在1秒内加载完成。

长时间运行稳定性测试
启动应用，连续运行3小时，观察应用是否出现崩溃、卡顿等异常。
应用应连续稳定运行3小时，无崩溃、卡顿等异常。

系统资源占用测试
使用性能监控工具记录应用运行时的内存、CPU占用情况，分析资源占用是否合理。
应用运行时的内存、CPU占用应在合理范围内。

由于部分依赖和资源文件的问题导致Android Studio导出的APK所占空间过大，达到了100MB，因此安装时间会相对过长，这个问题后期会进行优化，但CPU和内存占用表现还算可以
2.兼容性测试
项目
内容
预期结果

不同品牌型号手机测试
在不同品牌型号的手机上安装应用，运行应用，观察是否出现异常。
应用应在所有测试手机上正常运行，无异常。

不同操作系统版本测试
在不同操作系统版本的手机上安装应用，运行应用，观察是否出现异常。
应用应在所有测试操作系统版本上正常运行，无异常。

不同屏幕尺寸测试
 在不同屏幕尺寸的手机上安装应用，运行应用，观察界面显示是否清晰、完整。
应用应在所有测试屏幕尺寸显示清晰、完整，无异常。

本次测试选取了30款手机进行测试
(1) 不同操作系统版本测试
测试的操作系统包括：Android14、Android13、Android12、Android10、Android7.0、Android6.0.1、Android6.0、Android9.0均正常运行
(2) 不同品牌型号手机测试
测试的手机品牌包括：小米、华为、魅族、荣耀、三星、华硕、努比亚、OPPO、VIVO等品牌均正常运行
(3) 不同屏幕尺寸测试
测试的屏幕尺寸类型有：5.99英寸、5.73英寸、5.7英寸、5.5英寸、5.46英寸、5.2英寸、5.15英寸、5.0英寸，在所有安装成功的机型上，不同屏幕尺寸的机型均可显示清晰、完整，无异常。
本次选取的手机数量较少，因此结果仅供参考，但所有手机均可正常安装、运行和卸载，说明该软件兼容性还算可以
十、项目总结与展望

本应用实现了一个功能完整的即时通讯APP，从用户注册登录到聊天通信，音视频通话均可正常使用，基本掌握了安卓开发的入门知识，数据库的数据管理和SDK集成与第三方接口调用等知识
目前仍有部分Bug，目前已知bug，从消息列表点击开始聊天时有小概率会闪屏一下，后续会看情况进行修复
未来计划展望：
• 目前本应用所有数据都保存在云端数据库，未作本地化存储，在网络不佳的情况下会产生很多问题，未来会做本地化的数据存储，做离线缓存处理
• 添加图片、视频和文件消息发送接收的支持
• 增加群聊功能

相关代码架构参考
https://github.com/zoufaxu/ChatApp.git
https://github.com/chunyu-li/cyan
